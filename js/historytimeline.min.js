d3.tl={};d3.tl.Era=function(b,a,c,d){this.label=b||"Example Label";this.start=a||-380;this.stop=c||-220;this.bgcolor=d||"#F5BCA9";this.topY=0;this.height=1;this.voffset=0;this.labelTopMargin=this.labelFontFamily=this.labelFontSize=null};
d3.tl.Timeline=function(b){this.dataOrigin=this.tlid=null;this.scale=1;this.title="Placeholder Title:";this.subtitle="Subtitle Placeholder";this.eraTopMargin=30;this.eraHeight=300;this.timeAxisHeight=50;this.timeAxisTopMargin=15;this.timeAxisFontSize=13;Object.defineProperty(this,"svgHeight",{get:function(){return this.eraTopMargin+this.eraHeight+this.timeAxisHeight}});this.svgWidth=1200;"eraUI"===b&&(this.svgWidth=500);this.svgSideMargin=25;this.borderColor="#A41034";this.backgroundColor="bisque";
this.containerFontFamily='Palatino, Times, "Times New Roman", Georgia, serif';this.containerBackgroundColor="white";this.titleFontSize=24;this.subtitleFontSize=18;this.headerPaddingTop=20;this.headerPaddingSides=30;Object.defineProperty(this,"headerPadding",{get:function(){return this.headerPaddingTop+"px "+this.headerPaddingSides+"px"}});this.headerMarginBottom=20;this.footerFontSize=12;this.footerPaddingTop=10;this.footerPaddingSides=15;Object.defineProperty(this,"footerPadding",{get:function(){return this.footerPaddingTop+
"px "+this.footerPaddingSides+"px"}});this.footerMarginTop=20;this.quizTargetEra=this.targetLabel=this.remainingLabels=this.quizFudges=this.quizIncorrect=this.quizCorrect=this.footerTextBuffer=this.containerID=this.timeScale=this.axisStopYr=this.axisStartYr=this.dataOrigin=null;this.erasArr=[new d3.tl.Era];this.eraLabelsFontSize=16;this.eraLabelsFontFamily='Palatino, Times, "Times New Roman", Georgia, serif';this.eraLabelTopMargin=10;this.eraDateFontSize=16;this.containerStyles=function(){return{position:"relative",
width:this.svgWidth+4+"px","font-family":this.containerFontFamily,"background-color":this.containerBackgroundColor}};this.footerHTML='<span class="drawnBy">Drawn by historytimeline.js. (<a href="https://github.com/bruml2/historytimeline">Info and code</a>)</span>';this.hasEraDatesOnHover=this.hasFooter=this.hasHeader=!0;this.showingAll=this.showingDates=this.hasEmblems=this.hasPeople=this.hasEvents=this.hasFooterTextOnHover=this.hasPrecipEventsOnHover=!1;this.D3eraDatesGrps=this.D3eraLabelsGrp=this.D3erasGrp=
this.D3eras=this.D3svg=this.D3timeline=null;this.builderMinMax={};this.created=new Date;this.lastModified=new Date;this.showD3selectionsInConsole=!1};d3.tl.Timeline.prototype.loadTimeline=function(b){for(var a in b)b.hasOwnProperty(a)&&(this[a]=b[a]);this.precipEventsObj&&(this.hasPrecipEventsOnHover=!0);this.footerTextObj&&(this.hasFooterTextOnHover=!0);this.eventsArr&&(this.hasEvents=!0);console.log("Loaded . . .")};
d3.tl.Timeline.prototype.scaleTimeline=function(b){var a=this;a.scale=b;"eraTopMargin eraHeight timeAxisHeight timeAxisTopMargin timeAxisFontSize svgWidth svgSideMargin titleFontSize subtitleFontSize headerPaddingTop headerPaddingSides headerMarginBottom footerFontSize footerPaddingTop footerPaddingSides footerMarginTop eraLabelTopMargin eraLabelsFontSize eraDateFontSize".split(" ").forEach(function(c){a[c]*=b})};
d3.tl.Timeline.prototype.styleContainer=function(b){console.log("=== starting "+b+" ===");this.containerID=b;d3.select("#"+b).style({position:"relative",width:this.svgWidth+4+"px","font-family":this.containerFontFamily,"background-color":this.containerBackgroundColor})};
d3.tl.Timeline.prototype.addHeaderDiv=function(){var b=this;d3.select("#"+b.containerID).append("div").attr("id",b.containerID+"-header").style({padding:b.headerPadding,"margin-bottom":b.headerMarginBottom+"px",border:"2px solid "+b.borderColor}).each(function(){d3.select(this).append("span").attr("id",b.containerID+"-title").style({"font-size":b.titleFontSize+"px",color:b.borderColor}).html(b.title);d3.select(this).append("span").attr("id",b.containerID+"-subtitle").style({"font-size":b.subtitleFontSize+
"px"}).html("&nbsp;&nbsp;"+b.subtitle)})};
d3.tl.Timeline.prototype.addTimelineDiv=function(){d3.select("#"+this.containerID).style(this.containerStyles).append("div").attr("id",this.containerID+"-timeline").attr("class","historytimeline").style({position:"relative"}).append("svg").style({width:this.svgWidth,height:this.svgHeight,border:"2px solid "+this.borderColor,"background-color":this.backgroundColor});this.D3timeline=d3.select("#"+this.containerID+"-timeline");this.D3svg=d3.select("#"+this.containerID+"-timeline svg");null===document.getElementById("globalTimelineStyles")?
d3.select("body").append("style").attr("id","globalTimelineStyles").text(".timeAxisGrp path, .timeAxisGrp line {  fill: none;  stroke: black;  shape-rendering: crispEdges; /* SVG attribute */}.timeAxisGrp text {  font-family: sans-serif;  font-size: "+this.timeAxisFontSize+"px;  text-rendering: optimizeLegibility; /* SVG attribute */}.historytimeline .hidden {  display: none; }.precipEventsPanel {  position: absolute;  z-index: 2;  border: solid 1px #aaa;  border-radius: 8px;  background: aliceblue;  max-width: 400px;  opacity: 0.000001;  font: 15px sans-serif;  pointer-events: none;}.precipEventsPanel p {  margin: 0;  padding: 6px}"):
console.log("Already have globalTimelineStyles");1!==this.scale&&d3.select("body").append("style").attr("class","customTimeAxisStyle").text("#"+this.containerID+"-timeline .timeAxisGrp text {  font-family: sans-serif;  font-size: "+this.timeAxisFontSize+"px;  text-rendering: optimizeLegibility; /* SVG attribute */}")};
d3.tl.Timeline.prototype.addFooterDiv=function(){d3.select("#"+this.containerID).style(this.containerStyles).append("div").attr("id",this.containerID+"-footer").style({padding:this.footerPadding,"margin-top":this.footerMarginTop+"px",border:"2px solid "+this.borderColor,"font-size":this.footerFontSize+"px"}).html(this.footerHTML)};
d3.tl.Timeline.prototype.drawTimeAxis=function(){var b,a;null!==this.axisStartYr&&null!==this.axisStopYr?(b=this.axisStartYr,a=this.axisStopYr):(b=d3.min(this.erasArr,function(a){return a.start}),a=d3.max(this.erasArr,function(a){return a.stop}));this.timeScale=d3.scale.linear().domain([b,a]).rangeRound([this.svgSideMargin,this.svgWidth-this.svgSideMargin]).nice();b=d3.svg.axis().scale(this.timeScale);this.D3svg.append("g").attr("class","timeAxisGrp").attr("transform","translate(0, "+(this.eraTopMargin+
this.eraHeight+this.timeAxisTopMargin)+")").call(b)};
d3.tl.Timeline.prototype.drawEras=function(b){var a=this;this.D3eras=this.D3svg.append("g").attr("class","erasGrp").selectAll("rect").data(this.erasArr).enter().append("rect").attr("id",function(b){return a.containerID+"-"+b.label.replace(/\W/g,"")+"Era"}).attr("class","era").attr("x",function(b){return a.timeScale(b.start)}).attr("y",function(b){return a.eraTopMargin+b.topY*a.eraHeight}).attr("rx",4).attr("ry",4).attr("width",function(b){return a.timeScale(b.stop)-a.timeScale(b.start)}).attr("height",
function(b){return b.height*a.eraHeight}).style("fill",function(a){return a.bgcolor}).style("stroke-width",1).style("stroke","black").on("mouseover",function(){if(a.hasEraDatesOnHover&&!a.showingAll){var b="#"+a.containerID+"-timeline .eraDateGrp ."+this.__data__.label.replace(/\W/g,"");d3.selectAll(b).classed("hidden",!1)}if(a.hasPrecipEventsOnHover&&!a.showingAll){var d=this.__data__,b=a.timeScale(d.start)-10,f=a.eraTopMargin+d.topY*a.eraHeight+46,d=a.precipEventsObj[d.start]+a.precipEventsObj[d.stop];
a.D3precipEventsPanel.style("position","absolute").style("left",b+"px").style("top",f+"px").style("opacity",1E-6).html(d).transition().duration(400).style("opacity",.95)}a.hasFooterTextOnHover&&(b=d3.select("#"+a.containerID+"-footer"),a.footerTextBuffer=b.html(),b.html(a.footerTextObj[this.__data__.label]).classed("hidden",!1))}).on("mouseout",function(){if(!a.showingDates&&!a.showingAll&&a.hasEraDatesOnHover){var b="#"+a.containerID+"-timeline .eraDateGrp ."+this.__data__.label.replace(/\W/g,"");
d3.selectAll(b).classed("hidden",!0)}a.hasPrecipEventsOnHover&&a.D3precipEventsPanel.transition().duration(400).style("opacity",1E-6);a.hasFooterTextOnHover&&d3.select("#"+a.containerID+"-footer").html(a.footerTextBuffer)});b&&this.D3eras.each(function(a,d){this.__data__.label===b?d3.select(this).style("stroke-width",2):d3.select(this).style("opacity",.5)});this.D3timeline.append("div").attr("class","precipEventsPanel");this.D3precipEventsPanel=d3.select("#"+this.containerID+"-timeline .precipEventsPanel");
this.D3erasGrp=d3.select("#"+this.containerID+"-timeline .erasGrp")};
d3.tl.Timeline.prototype.drawEraLabels=function(b){function a(a){a.voffset=a.voffset?a.voffset:0;var b=a.label.split(/ /).sort(function(a,b){return b.length-a.length})[0],e=document.createElement("span");e.setAttribute("style","font-family: "+c.eraLabelsFontFamily+"; font-size: "+c.eraLabelsFontSize+"px");e.innerHTML=b;b=document.getElementById("widthSpanContainer");b.appendChild(e);e=b.lastChild.offsetWidth;b=c.timeScale(a.stop)-c.timeScale(a.start);if(b>e)return a.width=b,c.timeScale(a.start)+"px";
a.width=e+2;return c.timeScale(a.start)-(a.width-b)/2+"px"}var c=this;d3.select("body").append("div").attr("id","widthSpanContainer").style("font-family",c.eraLabelsFontFamily).style("font-size",c.eraLabelsFontSize+"px").style("visibility","hidden");this.D3timeline.append("g").attr("class","eraLabelsGrp").selectAll("div").data(this.erasArr).enter().append("div").attr("id",function(a){return c.containerID+"-"+a.label.replace(/\W/g,"")+"Label"}).attr("class","eraLabel").style("position","absolute").style("z-index",
"1").style("text-align","center").style("left",function(b){return a(b)}).style("top",function(a){return c.eraTopMargin+a.topY*c.eraHeight+c.eraLabelTopMargin+a.voffset+"px"}).style("width",function(a){return a.width+"px"}).style("font-family",function(a){return a.labelFont?a.labelFont:this.eraLabelsFontFamily}).style("font-size",function(a){return(a.labelFontSize?a.labelFontSize:c.eraLabelsFontSize)+"px"}).style("color",function(a){return a.labelColor?a.labelColor:"black"}).style("opacity",function(a){return void 0==
b||a.label===b?1:.5}).style("pointer-events","none").text(function(a){return a.label});this.D3eraLabelsGrp=d3.select("#"+this.containerID+"-timeline .eraLabelsGrp");d3.select("#widthSpanContainer").remove()};
d3.tl.Timeline.prototype.drawEraDates=function(){function b(b){var d="start"==b?!0:!1;a.D3svg.append("g").attr("class",d?"eraStartDateGrp eraDateGrp":"eraStopDateGrp eraDateGrp").selectAll("text").data(a.erasArr).enter().append("text").attr("class",function(a){return a.label.replace(/\W/g,"")+" eraDate"}).classed("hidden",!0).attr("text-anchor","middle").attr("x",function(b){return a.timeScale(d?b.start:b.stop)}).attr("y",a.eraTopMargin-.5*parseInt(a.eraDateFontSize)).text(function(a){return d?a.start:
a.stop}).attr("font-family","sans-serif").attr("font-size",a.eraDateFontSize).attr("fill","black").attr("text-rendering","optimizeLegibility")}if(this.hasEraDatesOnHover){var a=this;b("start");b("stop");this.D3eraDatesGrps=d3.selectAll("#"+a.containerID+"-timeline .eraDateGrp")}else console.log(this.hasEraDatesOnHover+": Skipping era dates")};
d3.tl.Timeline.prototype.drawEvents=function(){var b=this;b.D3events=b.D3svg.append("g").attr("class","eventsGrp").selectAll("circle").data(b.eventsArr).enter().append("circle").style("fill","#666").attr("id",function(a){return a.label.replace(/\W/g,"")+"Label"}).attr("cx",function(a){return b.timeScale(a.date)}).attr("cy",function(a){return a.centerY*b.eraHeight+b.eraTopMargin}).attr("r",6).on("mouseover",function(){console.log("Event mouseover");var a=this.__data__,c=b.timeScale(a.date)-30,d=b.eraTopMargin+
a.centerY*b.eraHeight+16,a=a.label;console.log(b.D3precipEventsPanel);b.D3precipEventsPanel.style("max-width","200px").style("position","absolute").style("left",function(a){return c+"px"}).style("top",d+"px").style("opacity",1E-6).html(a).transition().duration(500).style("opacity",.95)}).on("mouseout",function(){b.D3precipEventsPanel.transition().duration(500).style("opacity",1E-6)})};
d3.tl.Timeline.prototype.setup=function(b){1!==this.scale&&this.scaleTimeline(this.scale);this.styleContainer(b);this.hasHeader&&this.addHeaderDiv();this.addTimelineDiv();this.hasFooter&&this.addFooterDiv()};
d3.tl.Timeline.prototype.draw=function(b){this.drawTimeAxis();this.drawEras(b);this.drawEraLabels(b);this.hasEraDatesOnHover&&this.drawEraDates();this.hasEvents&&this.drawEvents();!0===this.showD3selectionsInConsole&&(console.log("D3timeline: ",this.D3timeline),console.log("D3svg: ",this.D3svg),console.log("D3erasGrp: ",this.D3erasGrp),console.log("D3eras: ",this.D3eras),console.log("D3eraLabelsGrp: ",this.D3eraLabelsGrp),console.log("D3eraDatesGrps: ",this.D3eraDatesGrps))};
d3.tl.drawTimelineInContainer=function(b,a,c){d3.tl.singleTimeline=new d3.tl.Timeline;d3.tl.singleTimeline.loadTimeline(b);c&&("object"===typeof c?d3.tl.singleTimeline.loadTimeline(c):c.forEach(function(a){d3.tl.singleTimeline.loadTimeline(a)}));d3.tl.singleTimeline.setup(a);d3.tl.singleTimeline.draw()};
d3.tl.Timeline.prototype.initQuiz=function(b){this.hasFooterTextOnHover=this.hasPrecipEventsOnHover=this.hasEraDatesOnHover=!1;this.quizFudges=this.quizIncorrect=this.quizCorrect=0;this.remainingLabels=[];this.erasArr.forEach(function(a){this.remainingLabels.push(a.label)},this);var a=this;d3.select("#"+this.containerID).append("div").attr("id",this.containerID+"-quizPanel").style({position:"absolute",left:"400px",top:"10px",padding:"20px 40px","text-align":"center",border:"4px solid red","border-radius":"8px",
"background-color":"aliceblue"}).each(function(){d3.select(this).append("p").style({"margin-top":"0","margin-bottom":"0.5em"}).html('What is the name of the era with the <span style="color: red;">red</span> star?');d3.select(this).append("input").attr("type","text").attr("id",this.containerID+"-quizTextbox").attr("placeholder","type answer here").attr("size","20").style({"padding-left":"0.3em","font-size":"36px"}).on("input",function(){var b=this;if(this.value===a.targetLabel||a.answerIsCloseEnough(this.value,
a.targetLabel))d3.select("#"+a.containerID+"-quizPanel").append("span").attr("class","quizPanelYES").style({position:"absolute",left:"100px",top:"30px","font-size":"72px","font-weight":"bold",color:"green"}).html("YES"),setTimeout(function(){b.value="";d3.select("#"+a.containerID+"-quizPanel .quizPanelYES").remove()},2E3),a.quizCorrect++,console.log("Correct: "+a.quizCorrect),d3.select("#"+a.containerID+"-"+a.targetLabel.replace(/\W/g,"")+"Label").style("color","black"),7<a.remainingLabels.length?
a.nextQuizItem():a.scoreQuiz()}).on("keypress",function(){13===d3.event.keyCode&&(a.quizIncorrect++,console.log("Incorrect: "+a.quizIncorrect),7<a.remainingLabels.length?a.nextQuizItem():a.scoreQuiz())})});this.nextQuizItem()};
d3.tl.Timeline.prototype.nextQuizItem=function(){this.targetLabel=this.remainingLabels.shift();d3.select("#"+this.containerID+"-"+this.targetLabel.replace(/\W/g,"")+"Label").style("color","transparent");this.targetEraD3=d3.select("#"+this.containerID+"-"+this.targetLabel.replace(/\W/g,"")+"Era")};
d3.tl.Timeline.prototype.answerIsCloseEnough=function(b,a){var c={Judges:["the judges","thejudges","jugdes"],"United Kingdom":["united monarchy","unitedkingdom","unitedmonarchy"],"Northern Kingdom (Israel)":["northernkingdom","kingdom of israel"],"Southern Kingdom (Judah)":["southernkingdom","kingdom of judah"],Exile:["babylonia","babylonianexile"],"Persian Period":["persian","persianperiod"],"Hellenistic Period":["hellenistic","hellenisticperiod","greek"],"Maccabean (Hasmonean) Rule":"maccabean;hasmonean;maccabeanrule;maccabean rule;hasmonean rule;hasmoneanrule".split(";"),
"Rome: Temple":["rome","rometemple","romewithtemple","romeandtemple"]},d=b.toLowerCase(),f=a.toLowerCase();console.log(a,c[a],d,f);return d===f?(this.quizFudges++,!0):-1<c[a].indexOf(d)?(console.log("found: "+c[a][c[a].indexOf(d)]),this.quizFudges++,!0):!1};
d3.tl.Timeline.prototype.scoreQuiz=function(){d3.select("#"+this.containerID).append("div").attr("id",this.containerID+"-scorePanel").style({position:"absolute",left:"400px",top:"10px",padding:"20px 40px","text-align":"center",border:"4px solid blue","border-radius":"8px","background-color":"aliceblue"}).each(function(){d3.select(this).append("p").style({"margin-top":"0","margin-bottom":"0.5em"}).html("Nice job! You got all the answers.");d3.select(this).append("button").attr("type","button").attr("id",
this.containerID+"-quizBtn").attr("value","OK").style({position:"absolute",left:"400px",top:"40px",padding:"0.3em","font-size":"20px"}).on("input",function(){})});console.log("END")};d3.tl.Timeline.prototype.removeTimelineContents=function(){for(var b=document.querySelector("#"+this.containerID+"-timeline svg");b.firstChild;)b.removeChild(b.firstChild);d3.select("#"+this.containerID+"-timeline .precipEventsPanel").remove();d3.select("#"+this.containerID+"-timeline .eraLabelsGrp").remove()};